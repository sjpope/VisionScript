<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VisionScript Baby!!!</title>
  <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
</head>
<body>
  <h1>VisionScript Baby!!!</h1>

  <div id="log" style="height: 200px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-top: 20px;"></div>

  <script>

    // timestamp / elapsedTime - time in milliseconds since begin() was invoked
    window.onload = function() 
    {
      webgazer.setGazeListener(function(data, timestamp) 
      {
        if (data) 
        {
          const logElement = document.getElementById('log');
          const message = `X: ${data.x.toFixed(2)}, Y: ${data.y.toFixed(2)}, Timestamp: ${timestamp.toFixed(2)}`;
          

          console.log(message); 

          // Update log browser output window
          logElement.innerHTML += message + '<br>';

          // Auto scroll as the log continues
          // logElement.scrollTop = logElement.scrollHeight;

          // Send data to the server. Log only for initial dev
          fetch('/data', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ data: { x: data.x, y: data.y, timestamp } })
          });
        }

      }).begin();

      webgazer.showPredictionPoints(true);

    };

  </script>
</body>
</html>

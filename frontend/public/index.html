<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VisionScript Baby!!!</title>
  <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
</head>
<body>
  <h1>VisionScript Baby!!!</h1>

  <div id="log" style="height: 200px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-top: 20px;">
  </div>


  <div id="controlPanel">
    <button onclick="startSession()">Start Session</button>
    <button onclick="pauseSession()">Pause Session</button>
    <button onclick="endSession()">End Session</button>
  </div>

  <script>
    let isTracking = false;

    function initializeWebGazer() {
      webgazer.setGazeListener(function (data, timestamp) {
        if (data) {
          const logElement = document.getElementById('log');
          const message = `X: ${data.x.toFixed(2)}, Y: ${data.y.toFixed(2)}, Timestamp: ${timestamp.toFixed(2)}`;
          console.log(message);
          logElement.innerHTML += message + '<br>';
          logElement.scrollTop = logElement.scrollHeight;

          // Send data to the server for further processing
          fetch('/data', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ data: { x: data.x, y: data.y, timestamp } })
          });
        }
      }).begin();
      webgazer.showPredictionPoints(true);
      isTracking = true;
    }
    
    function startSession() {
      fetch('/start', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
          console.log(data.message);
          if (!isTracking) {
            initializeWebGazer();
          }
        });
    }

    function pauseSession() {
      fetch('/pause', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
          console.log(data.message);
          webgazer.pause();
        });
    }

    function endSession() {
      fetch('/end', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
          console.log(data.message);
          webgazer.end(); // Completely stop the regression model
          isTracking = false;
        });
    }

    
  </script>

</body>
</html>

<style>
  #log {
    position: fixed;
    bottom: 10px;
    right: 10px;
    width: 300px;
    height: 200px;
    overflow-y: scroll;
    background: #fff;
    border: 1px solid #ccc;
    padding: 10px;
    font-size: 12px;
    z-index: 1000;
  }

  #controlPanel {
  position: fixed;
  top: 10px;
  left: 10px;
  z-index: 1500; 
}

#webgazerVideoFeed {
  position: fixed;
  bottom: 10px;
  left: 10px;
  z-index: 500; 
}

#webgazerCanvas {
  position: fixed;
  bottom: 10px;
  left: 10px;
  z-index: 600; 
}

</style>